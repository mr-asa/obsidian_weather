/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var pe=Object.defineProperty;var wt=Object.getOwnPropertyDescriptor;var bt=Object.getOwnPropertyNames;var ft=Object.prototype.hasOwnProperty;var yt=(s,o)=>{for(var e in o)pe(s,e,{get:o[e],enumerable:!0})},vt=(s,o,e,t)=>{if(o&&typeof o=="object"||typeof o=="function")for(let i of bt(o))!ft.call(s,i)&&i!==e&&pe(s,i,{get:()=>o[i],enumerable:!(t=wt(o,i))||t.enumerable});return s};var St=s=>vt(pe({},"__esModule",{value:!0}),s);var Gt={};yt(Gt,{default:()=>Z});module.exports=St(Gt);var qe=require("obsidian");var ee=require("obsidian"),te=class{constructor(o){this.plugin=o}insertWidgetPlaceholder(){var i,n,a,r;let o=this.plugin.getStrings(),e=this.getActiveCanvasView();if(!e){new ee.Notice(o.notices.openCanvasFirst);return}if(!((n=(i=e.canvas)==null?void 0:i.createTextNode)==null?void 0:n.call(i,{text:"```weather-widget\n```\n",pos:{x:200,y:200},size:{width:320,height:200}}))){new ee.Notice(o.notices.canvasCreationFailed);return}(r=(a=e.canvas)==null?void 0:a.requestSave)==null||r.call(a),new ee.Notice(o.notices.canvasPlaceholderAdded)}getActiveCanvasView(){var t;let o=(t=this.plugin.app.workspace.activeLeaf)!=null?t:null,e=o==null?void 0:o.view;return(e==null?void 0:e.getViewType())!=="canvas"?null:e}unregister(){}};function Be(s,o){let e=s.getStrings();s.addCommand({id:"weather-widget-open-tab",name:e.commands.openTab,callback:()=>{s.activateView()}}),s.addCommand({id:"weather-widget-insert-canvas",name:e.commands.insertCanvas,callback:()=>{o.insertWidgetPlaceholder()}})}function y(s,o,e){return Math.min(Math.max(s,o),e)}function N(s,o,e){return s+(o-s)*e}function ie(s){return Math.min(255,Math.max(0,Math.round(s)))}function we(s){let o=s.replace(/^#/,"").trim(),e=o.length===3?o.split("").map(i=>i+i).join(""):o,t=parseInt(e,16);return Number.isNaN(t)||e.length!==6&&e.length!==8?{r:0,g:0,b:0}:{r:t>>16&255,g:t>>8&255,b:t&255}}function Mt({r:s,g:o,b:e}){let t=i=>ie(i).toString(16).padStart(2,"0");return`#${t(s)}${t(o)}${t(e)}`}function W(s){let o=s/255;return o<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function me(s){let o=Math.max(0,Math.min(1,s));return o<=.0031308?o*12.92*255:(1.055*Math.pow(o,1/2.4)-.055)*255}function x(s,o,e){let t=Math.min(1,Math.max(0,e)),i=we(s),n=we(o),a=me(W(i.r)+(W(n.r)-W(i.r))*t),r=me(W(i.g)+(W(n.g)-W(i.g))*t),g=me(W(i.b)+(W(n.b)-W(i.b))*t);return Mt({r:a,g:r,b:g})}function M(s,o){let{r:e,g:t,b:i}=we(s),n=Math.min(1,Math.max(0,o));return`rgba(${ie(e)}, ${ie(t)}, ${ie(i)}, ${n})`}function b(s,o="#000000"){if(!s)return o;let e=s.trim();return/^#([0-9a-f]{3}|[0-9a-f]{6}|[0-9a-f]{8})$/i.test(e)?e:o}var z=1440,Ct=6e4,Lt={morning:"\u{1F305}",day:"\u{1F31E}",evening:"\u{1F307}",night:"\u{1F319}"},xt="\u2601";function E(s){return y(s,0,1)}function ne(s){return .5-.5*Math.cos(Math.PI*E(s))}function Ie(s){return s>=6&&s<12?"morning":s>=12&&s<18?"day":s>=18&&s<22?"evening":"night"}function Tt(s,o){if(s==null||Number.isNaN(s)||o.length===0)return"#9ca3af";let e=[...o].sort((t,i)=>t.temperature-i.temperature);if(s<=e[0].temperature)return b(e[0].color,"#9ca3af");if(s>=e[e.length-1].temperature)return b(e[e.length-1].color,"#9ca3af");for(let t=0;t<e.length-1;t+=1){let i=e[t],n=e[t+1];if(s>=i.temperature&&s<=n.temperature){let a=(s-i.temperature)/(n.temperature-i.temperature);return x(b(i.color),b(n.color),a)}}return b(e[0].color,"#9ca3af")}function Nt(s){let o=typeof s=="number"?s:2;return o===0||o===1?"sunny":o===2||o===3?"cloudy":o===45||o===48?"foggy":[51,53,55,56,57].includes(o)?"drizzle":[61,63,65,66,67,80,81,82].includes(o)?"rainy":[71,73,75,77,85,86].includes(o)?"snowy":[95,96,99].includes(o)?"storm":"cloudy"}function H(s){if(!s)return null;let o=/(T)(\d{2}):(\d{2})/.exec(s);if(!o)return null;let e=parseInt(o[2],10),t=parseInt(o[3],10);return e*60+t}function fe(s,o){try{let e=s.toLocaleTimeString(void 0,{timeZone:o,hour:"2-digit",minute:"2-digit",hour12:!1}),[t,i]=e.split(":").map(n=>parseInt(n,10));if(Number.isFinite(t)&&Number.isFinite(i))return t*60+i}catch(e){console.warn("WeatherWidget: failed to format time in timezone",o,e)}return s.getHours()*60+s.getMinutes()}function ye(s){let o=Math.round(s*4);return Math.max(-12*60,Math.min(14*60,o))}function ve(s,o){let e=-s.getTimezoneOffset(),t=o-e;return new Date(s.getTime()+t*Ct)}function Se(s,o){let e=ve(s,ye(o));return e.getHours()*60+e.getMinutes()}function Dt(s,o,e,t){if(o)try{return s.toLocaleTimeString(t,{timeZone:o,hour:"2-digit",minute:"2-digit",hour12:!1})}catch(n){console.warn("WeatherWidget: failed to format time with timezone",o,n)}return ve(s,ye(e)).toLocaleTimeString(t,{hour:"2-digit",minute:"2-digit",hour12:!1})}function Et(s,o,e,t){if(o)try{return s.toLocaleDateString(t,{timeZone:o,day:"2-digit",month:"2-digit"})}catch(n){console.warn("WeatherWidget: failed to format date with timezone",o,n)}return ve(s,ye(e)).toLocaleDateString(t,{day:"2-digit",month:"2-digit"})}function At(s,o,e,t){let i=H(s),n=H(o);if(i==null||n==null||n<=i)return 0;let a=new Date,r=e?fe(a,e):Se(a,t);return r<=i?0:r>=n?100:(r-i)/(n-i)*100}function _t(s,o,e,t,i){let n=H(o),a=H(e),r=new Date,g=t?fe(r,t):Se(r,i);if(n==null||a==null||a<=n){let d=Ie(Math.floor(g/60));return{base:b(s.timeBaseColors[d]),tint:b(s.timeTintColors[d])}}let u=Math.floor((n+a)/2),l=[{m:0,base:b(s.timeBaseColors.night),tint:b(s.timeTintColors.night)},{m:n,base:b(s.timeBaseColors.morning),tint:b(s.timeTintColors.morning)},{m:u,base:b(s.timeBaseColors.day),tint:b(s.timeTintColors.day)},{m:a,base:b(s.timeBaseColors.evening),tint:b(s.timeTintColors.evening)},{m:z,base:b(s.timeBaseColors.night),tint:b(s.timeTintColors.night)}];for(let d=0;d<l.length-1;d+=1){let w=l[d],p=l[d+1];if(g>=w.m&&g<=p.m){let m=(g-w.m)/Math.max(1,p.m-w.m);return{base:x(w.base,p.base,m),tint:x(w.tint,p.tint,m)}}}return{base:b(s.timeBaseColors.night),tint:b(s.timeTintColors.night)}}function be(s,o,e,t,i,n){let a=E(o),r=E(Math.max(a,e)),g=[`${M(s,0)} 0%`];for(let u=0;u<=n.steps;u+=1){let l=n.steps===0?0:u/n.steps,d=a+(r-a)*l,w=Math.pow(Math.sin(Math.PI*l),n.power),p=E(i+(t-i)*w),m=Math.round(d*1e3)/10;g.push(`${M(s,p)} ${m}%`)}return g.push(`${M(s,0)} 100%`),`linear-gradient(90deg, ${g.join(", ")})`}function Re(s,o){return o==="night"?Math.max(s.leftPanel.minHighlight,s.sunLayer.nightHighlight):o==="day"?Math.max(s.leftPanel.minHighlight,s.sunLayer.dayHighlight):Math.max(s.leftPanel.minHighlight,s.sunLayer.twilightHighlight)}var Y=class{constructor(o){this.plugin=o;this.host=null}mount(o){this.host=o,this.render()}update(){this.host&&this.render()}render(){var r,g,u,l,d,w;if(!this.host)return;let o=this.plugin.getStrings(),e=this.plugin.settings,t=this.plugin.getLocale();if(this.host.replaceChildren(),e.cities.length===0){this.host.createDiv({cls:"city-widget city-widget--empty",text:o.widget.forecastPlaceholder});return}let n=new Date().toLocaleDateString(t,{day:"2-digit",month:"2-digit"}),a=this.host.createDiv({cls:"city-widget"});for(let p of e.cities){let m=this.plugin.getWeatherSnapshot(p.id);if(!m){let S=a.createDiv({cls:"city-row city-row--loading"});S.createDiv({cls:"city-name",text:p.label}),S.createDiv({cls:"time-info",text:(r=o.widget.loadingLabel)!=null?r:"\u2026"}),S.createDiv({cls:"weather-info",text:"-"}),S.createDiv({cls:"temperature",text:"--"});continue}let h=m.timezone,v=new Date,D=Dt(v,h,p.longitude,t),f=Et(v,h,p.longitude,t),[V]=D.split(":"),xe=Number.parseInt(V!=null?V:"0",10),j=Ie(Number.isFinite(xe)?xe:0),Je=m.temperature==null||Number.isNaN(m.temperature)?"--":`${m.temperature>0?"+":""}${Math.round(m.temperature)}\xB0`,q=Nt(m.weatherCode),U=e.categoryStyles[q],Xe=(u=(g=U==null?void 0:U.icon)==null?void 0:g.trim())!=null?u:xt,de=b((l=U==null?void 0:U.color)!=null?l:"#6b7280","#6b7280"),Ze=(d=o.weatherConditions[q])!=null?d:q,Qe=At(m.sunrise,m.sunset,h,p.longitude),Te=H(m.sunrise),Ne=H(m.sunset),he=Te!=null?E(Te/z):e.daySpan.min,ge=Ne!=null?E(Ne/z):e.daySpan.max,J=Math.max(e.daySpan.min,Math.min(e.daySpan.max,ge-he)),De=E((J-e.daySpan.min)/Math.max(1e-4,e.daySpan.max-e.daySpan.min)),Ee=_t(e,m.sunrise,m.sunset,h,p.longitude),et=b(e.timeBaseColors[j]),tt=x(et,Ee.base,.6),it=x(tt,de,e.gradients.timeBlend.mixRatio),B=e.gradients.timeBlend,Ae=B.padding*N(B.widthMin,B.widthMax,De),nt=be(it,E(he-J*Ae),E(ge+J*Ae),B.peakAlpha,B.edgeAlpha,{steps:B.steps,power:B.power}),R=e.gradients.weather,_e=R.padding*N(R.widthMin,R.widthMax,De),Pe=.9*(q==="cloudy"||q==="foggy"?.7:1),at=be(de,E(he-J*_e),E(ge+J*_e),Pe*R.peakScale,Pe*.12*R.edgeScale,{steps:R.steps,power:R.power}),rt=be(Tt(m.temperature,e.temperatureGradient),e.gradients.temperature.start,e.gradients.temperature.end,e.gradients.temperature.peakAlpha,e.gradients.temperature.edgeAlpha,{steps:e.gradients.temperature.steps,power:e.gradients.temperature.power}),I=a.createDiv({cls:"city-row"});I.style.background=`${rt}, ${at}, ${nt}`,I.style.backgroundBlendMode="normal, soft-light, soft-light";let We=I.createDiv({cls:"sun-overlay"}),c=e.sunLayer,K=c.width,zt=Re(e,j),F=H(m.sunrise),A=H(m.sunset),L=h?fe(new Date,h):Se(new Date,p.longitude),ue=F!=null&&A!=null?L<F||L>A:j==="night",T=b(c.colors.day,"#FFD200"),k=c.alphaDay.peak,_=c.alphaDay.mid,P=c.alphaDay.low;if(F!=null&&A!=null)if(L>=Math.max(0,A-c.transitionMinutes)&&L<A){let S=ne(1-(A-L)/c.transitionMinutes);T=x(c.colors.day,c.colors.sunrise,S),k=c.alphaDay.peak,_=c.alphaDay.mid,P=c.alphaDay.low}else if(L>=A&&L<=Math.min(1440,A+c.transitionMinutes)){let S=ne((L-A)/c.transitionMinutes);T=x(c.colors.sunrise,c.colors.night,S),k=N(c.alphaDay.peak,c.alphaNight.peak,S),_=N(c.alphaDay.mid,c.alphaNight.mid,S),P=N(c.alphaDay.low,c.alphaNight.low,S)}else if((F-L+z)%z<=c.transitionMinutes){let S=(F-L+z)%z,Q=ne(1-S/c.transitionMinutes);T=x(c.colors.night,c.colors.sunrise,Q),k=N(c.alphaNight.peak,c.alphaDay.peak,Q),_=N(c.alphaNight.mid,c.alphaDay.mid,Q),P=N(c.alphaNight.low,c.alphaDay.low,Q)}else if(L>=F&&L<=F+c.transitionMinutes){let S=ne((L-F)/c.transitionMinutes);T=x(c.colors.sunrise,c.colors.day,S),k=c.alphaDay.peak,_=c.alphaDay.mid,P=c.alphaDay.low}else ue?(T=c.colors.night,k=c.alphaNight.peak,_=c.alphaNight.mid,P=c.alphaNight.low):(T=c.colors.day,k=c.alphaDay.peak,_=c.alphaDay.mid,P=c.alphaDay.low);else ue&&(T=c.colors.night,k=c.alphaNight.peak,_=c.alphaNight.mid,P=c.alphaNight.low);let G=Math.max(0,Math.min(100,Qe)),st=Math.max(0,G-K),ot=Math.max(0,G-K*c.softnessOuter),lt=Math.max(0,G-K*c.softnessInner),dt=Math.min(100,G+K*c.softnessInner),ht=Math.min(100,G+K*c.softnessOuter),gt=Math.min(100,G+K),ut=`linear-gradient(90deg,

        transparent 0%,

        transparent ${st}%,

        ${M(T,P)} ${ot}%,

        ${M(T,_)} ${lt}%,

        ${M(T,k)} ${G}%,

        ${M(T,_)} ${dt}%,

        ${M(T,P)} ${ht}%,

        transparent ${gt}%,

        transparent 100%)`,ct=`linear-gradient(180deg,

        rgba(0,0,0,${e.verticalFade.top}) 0%,

        rgba(0,0,0,${e.verticalFade.middle}) 20%,

        rgba(0,0,0,${e.verticalFade.middle}) 80%,

        rgba(0,0,0,${e.verticalFade.top}) 100%)`,Fe=Re(e,j),ke=Ee.tint||de,pt=`linear-gradient(90deg,

        ${M(ke,Fe)} 0%,

        ${M(ke,Fe)} ${e.leftPanel.width}%,

        transparent ${e.leftPanel.width+5}%,

        transparent 100%)`;We.style.background=`${ut}, ${ct}, ${pt}`,We.style.backgroundBlendMode=ue?"multiply, multiply, screen":"screen, normal, screen";let mt=I.createDiv({cls:"city-name"});mt.textContent=p.label||"-";let ce=I.createDiv({cls:"time-info"});ce.createSpan({text:(w=Lt[j])!=null?w:""}),ce.createSpan({text:D}),e.showDateWhenDifferent&&f!==n&&ce.createSpan({cls:"date",text:f});let He=I.createDiv({cls:"weather-info"});He.createSpan({text:Xe}),He.createSpan({text:Ze}),I.createDiv({cls:"temperature",text:Je})}}};function Ge(s){s.registerMarkdownCodeBlockProcessor("weather-widget",(o,e)=>{new Y(s).mount(e);let i=o.trim();i.length>0&&e.createEl("pre",{cls:"weather-widget__debug",text:s.getStrings().markdown.debugParameters+i})})}var ae=["sunny","cloudy","rainy","snowy","drizzle","storm","foggy"],X=["morning","day","evening","night"],O={language:"ru",cities:[],weatherCacheMinutes:60,autoRefreshMinutes:15,categoryStyles:{sunny:{color:"#60a5fa",icon:"\u2600"},cloudy:{color:"#e6e7ce",icon:"\u2601"},rainy:{color:"#6b7280",icon:"\u{1F327}"},snowy:{color:"#c7d2fe",icon:"\u2744"},drizzle:{color:"#9ca3af",icon:"\u{1F326}"},storm:{color:"#374151",icon:"\u26C8"},foggy:{color:"#d1d5db",icon:"\u{1F32B}"}},timeBaseColors:{morning:"#FF8C42",day:"#87CEEB",evening:"#FF6B6B",night:"#162331"},timeTintColors:{morning:"#FBD38D",day:"#22D3EE",evening:"#F472B6",night:"#0F172A"},sunLayer:{colors:{sunrise:"#FF4A00",day:"#FFD200",night:"#93C5FD"},alphaDay:{peak:.9,mid:.55,low:.22},alphaNight:{peak:.3,mid:.18,low:.08},transitionMinutes:60,width:9,softnessInner:.35,softnessOuter:.65,twilightHighlight:.24,dayHighlight:.6,nightHighlight:.08},gradients:{timeBlend:{mixRatio:.35,padding:.45,widthMin:.75,widthMax:1.35,peakAlpha:.32,edgeAlpha:.08,steps:6,power:1.35},weather:{padding:.18,widthMin:.65,widthMax:1.25,peakScale:.96,edgeScale:1.05,steps:7,power:1.08},temperature:{start:.58,end:1,peakAlpha:.8,edgeAlpha:.12,steps:6,power:1.05}},verticalFade:{top:.22,middle:.08},leftPanel:{width:34,minHighlight:.04},daySpan:{min:.12,max:.9},temperatureGradient:[{temperature:-40,color:"#0B3C91"},{temperature:-30,color:"#1E3A8A"},{temperature:-20,color:"#2563EB"},{temperature:-10,color:"#60A5FA"},{temperature:-5,color:"#93C5FD"},{temperature:0,color:"#9CA3AF"},{temperature:5,color:"#CBE1D0"},{temperature:15,color:"#ACDE8B"},{temperature:25,color:"#E3CD81"},{temperature:30,color:"#F8AC75"},{temperature:40,color:"#F37676"}],showDateWhenDifferent:!0};var C=require("obsidian");function re(s="id"){let o=Date.now().toString(36),e=Math.random().toString(36).slice(2,8);return`${s}-${o}-${e}`}var Pt=-90,Wt=90,Ft=-180,kt=180,Ht=-80,Bt=80,ze=.3,Oe=.4,Me="sunny",$e=20;function Ce(s){return y(s,0,1)}function Le(s,o,e,t,i,n,a){let r=Ce(o),g=Ce(Math.max(r,e)),u=[`${M(s,0)} 0%`];for(let l=0;l<=n;l+=1){let d=n===0?0:l/n,w=r+(g-r)*d,p=Math.pow(Math.sin(Math.PI*d),a),m=Ce(i+(t-i)*p),h=Math.round(w*1e3)/10;u.push(`${M(s,m)} ${h}%`)}return u.push(`${M(s,0)} 100%`),`linear-gradient(90deg, ${u.join(", ")})`}function Ve(s,o){if(o.length===0)return"#9ca3af";let e=[...o].sort((t,i)=>t.temperature-i.temperature);if(s<=e[0].temperature)return b(e[0].color,"#9ca3af");if(s>=e[e.length-1].temperature)return b(e[e.length-1].color,"#9ca3af");for(let t=0;t<e.length-1;t+=1){let i=e[t],n=e[t+1];if(s>=i.temperature&&s<=n.temperature){let a=(s-i.temperature)/(n.temperature-i.temperature);return x(b(i.color,"#9ca3af"),b(n.color,"#9ca3af"),a)}}return b(e[0].color,"#9ca3af")}var se=class extends C.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty();let t=this.plugin.getStrings();this.renderLocalizationSection(e,t),this.renderRefreshSection(e,t),this.renderLocationsSection(e,t),this.renderTimeColorsSection(e,t),this.renderWeatherPaletteSection(e,t),this.renderTemperatureGradientSection(e,t),this.renderSunLayerSection(e,t),this.renderGradientSection(e,t),this.renderDisplaySection(e,t)}renderLocalizationSection(e,t){let i=e.createDiv({cls:"weather-settings__section"});i.createEl("h3",{text:t.settings.localization.heading}),new C.Setting(i).setName(t.settings.localization.languageLabel).setDesc(t.settings.localization.languageDescription).addDropdown(n=>{Object.keys(t.languageNames).forEach(a=>{n.addOption(a,t.languageNames[a])}),n.setValue(this.plugin.settings.language),n.onChange(async a=>{this.plugin.settings.language=a,await this.plugin.saveSettings(),this.display()})})}renderRefreshSection(e,t){let i=e.createDiv({cls:"weather-settings__section"});i.createEl("h3",{text:t.settings.refresh.heading}),i.createEl("p",{text:t.settings.refresh.description,cls:"weather-settings__hint"}),new C.Setting(i).setName(t.settings.refresh.autoRefreshLabel).setDesc(t.settings.refresh.autoRefreshDescription).addText(n=>{n.inputEl.type="number",n.inputEl.min="1",n.inputEl.step="1",n.setValue(String(this.plugin.settings.autoRefreshMinutes)),n.onChange(a=>{let r=Number(a);if(Number.isFinite(r)&&r>0){let g=Math.max(1,Math.round(r));this.plugin.settings.autoRefreshMinutes=g,n.setValue(String(g)),this.plugin.saveSettings()}})}),new C.Setting(i).setName(t.settings.refresh.cacheLabel).setDesc(t.settings.refresh.cacheDescription).addText(n=>{n.inputEl.type="number",n.inputEl.min="5",n.inputEl.step="5",n.setValue(String(this.plugin.settings.weatherCacheMinutes)),n.onChange(a=>{let r=Number(a);if(Number.isFinite(r)&&r>0){let g=Math.max(5,Math.round(r));this.plugin.settings.weatherCacheMinutes=g,n.setValue(String(g)),this.plugin.saveSettings()}})})}renderLocationsSection(e,t){let i=e.createDiv({cls:"weather-settings__section"});i.createEl("h3",{text:t.settings.locations.heading}),i.createEl("p",{text:t.settings.locations.description,cls:"weather-settings__hint"});let n=i.createEl("table",{cls:"weather-settings__table"}),a=n.createTHead().insertRow();[t.settings.locations.tableHeaders.label,t.settings.locations.tableHeaders.latitude,t.settings.locations.tableHeaders.longitude,t.settings.locations.tableHeaders.actions].forEach(g=>{a.appendChild(document.createElement("th")).textContent=g});let r=n.createTBody();if(this.plugin.settings.cities.length===0){let u=r.insertRow().insertCell();u.colSpan=4,u.className="weather-settings__empty",u.textContent=t.settings.locations.emptyState}else this.plugin.settings.cities.forEach((g,u)=>{let l=r.insertRow();this.renderCityRow(l,g,u,t)});new C.Setting(i).addButton(g=>{g.setButtonText(t.settings.locations.addButtonLabel).onClick(()=>{this.plugin.settings.cities.push({id:re("city"),label:t.settings.locations.defaultLabel,latitude:0,longitude:0}),this.plugin.saveSettings(),this.display()})})}renderCityRow(e,t,i,n){let r=e.insertCell().createEl("input",{cls:"weather-settings__table-input",attr:{type:"text"}});r.value=t.label,r.addEventListener("input",()=>{t.label=r.value.trim(),this.plugin.saveSettings()}),this.renderCoordinateCell(e,t,"latitude",Pt,Wt),this.renderCoordinateCell(e,t,"longitude",Ft,kt);let g=e.insertCell();g.className="weather-settings__table-actions";let u=g.createEl("button",{cls:"weather-settings__table-button weather-settings__table-button--icon",text:"\u2191"});u.disabled=i===0,u.addEventListener("click",()=>{this.swapCities(i,i-1)});let l=g.createEl("button",{cls:"weather-settings__table-button weather-settings__table-button--icon",text:"\u2193"});l.disabled=i===this.plugin.settings.cities.length-1,l.addEventListener("click",()=>{this.swapCities(i,i+1)}),g.createEl("button",{cls:"weather-settings__table-button",text:n.actions.remove}).addEventListener("click",()=>{this.plugin.settings.cities.splice(i,1),this.plugin.saveSettings(),this.display()})}renderCoordinateCell(e,t,i,n,a){let g=e.insertCell().createEl("input",{cls:"weather-settings__table-input",attr:{type:"number",step:"0.0001"}});g.value=String(t[i]),g.addEventListener("input",()=>{let u=g.value.replace(/,/g,".").trim();if(u===""||u==="-"||u==="+")return;let l=Number(u);if(!Number.isFinite(l))return;let d=Math.max(n,Math.min(a,l));t[i]=d,g.value=String(d),this.plugin.saveSettings()})}swapCities(e,t){let i=this.plugin.settings.cities;t<0||t>=i.length||([i[e],i[t]]=[i[t],i[e]],this.plugin.saveSettings(),this.display())}renderTimeColorsSection(e,t){let i=e.createDiv({cls:"weather-settings__section"});i.createEl("h3",{text:t.settings.timePalette.heading}),i.createEl("p",{text:t.settings.timePalette.description,cls:"weather-settings__hint"});let n=i.createDiv({cls:"weather-settings__color-grid"});X.forEach(a=>{new C.Setting(n).setName(t.sunPhases[a]).addColorPicker(g=>g.setValue(this.plugin.settings.timeBaseColors[a]).onChange(u=>{var l;this.plugin.settings.timeBaseColors[a]=u,this.plugin.saveSettings(),(l=this.updateTimeGradientPreview)==null||l.call(this)})).addColorPicker(g=>g.setValue(this.plugin.settings.timeTintColors[a]).onChange(u=>{var l;this.plugin.settings.timeTintColors[a]=u,this.plugin.saveSettings(),(l=this.updateTimeGradientPreview)==null||l.call(this)}))})}renderWeatherPaletteSection(e,t){let i=e.createDiv({cls:"weather-settings__section"});i.createEl("h3",{text:t.settings.weatherPalette.heading}),i.createEl("p",{text:t.settings.weatherPalette.description,cls:"weather-settings__hint"}),ae.forEach(n=>{new C.Setting(i).setName(t.weatherConditions[n]).addColorPicker(a=>a.setValue(this.plugin.settings.categoryStyles[n].color).onChange(r=>{var g,u;this.plugin.settings.categoryStyles[n].color=r,this.plugin.saveSettings(),(g=this.updateWeatherGradientPreview)==null||g.call(this),(u=this.updateTimeGradientPreview)==null||u.call(this)})).addText(a=>{a.setValue(this.plugin.settings.categoryStyles[n].icon),a.onChange(r=>{this.plugin.settings.categoryStyles[n].icon=r.trim()||O.categoryStyles[n].icon,this.plugin.saveSettings()})})})}renderTemperatureGradientSection(e,t){let i=e.createDiv({cls:"weather-settings__section"});i.createEl("h3",{text:t.settings.temperatureGradient.heading}),i.createEl("p",{text:t.settings.temperatureGradient.description,cls:"weather-settings__hint"});let n=i.createEl("table",{cls:"weather-settings__table"}),a=n.createTHead().insertRow();a.appendChild(document.createElement("th")).textContent=t.settings.temperatureGradient.tableHeaders.temperature,a.appendChild(document.createElement("th")).textContent=t.settings.temperatureGradient.tableHeaders.color,a.appendChild(document.createElement("th")).textContent=t.settings.locations.tableHeaders.actions;let r=n.createTBody();this.plugin.settings.temperatureGradient.forEach((g,u)=>{let l=r.insertRow();this.renderTemperatureRow(l,g,u,t)}),new C.Setting(i).addButton(g=>{g.setButtonText(t.settings.temperatureGradient.addButtonLabel).onClick(()=>{let u=O.temperatureGradient[O.temperatureGradient.length-1];this.plugin.settings.temperatureGradient.push({temperature:u.temperature,color:u.color}),this.sortTemperatureGradient()})})}renderTemperatureRow(e,t,i,n){let r=e.insertCell().createEl("input",{cls:"weather-settings__table-input",attr:{type:"number",step:"1"}});r.value=String(t.temperature),r.addEventListener("input",()=>{let m=Number(r.value);Number.isFinite(m)&&(t.temperature=Math.max(Ht,Math.min(Bt,Math.round(m))),r.value=String(t.temperature),this.sortTemperatureGradient())});let u=e.insertCell().createEl("input",{cls:"weather-settings__table-input weather-settings__table-input--color",attr:{type:"color"}});u.value=t.color,u.addEventListener("input",()=>{var m;t.color=u.value,this.plugin.saveSettings(),(m=this.updateTemperatureGradientPreview)==null||m.call(this)});let l=e.insertCell();l.className="weather-settings__table-actions";let d=l.createEl("button",{cls:"weather-settings__table-button weather-settings__table-button--icon",text:"\u2191"});d.disabled=i===0,d.addEventListener("click",()=>this.moveTemperatureStop(i,-1));let w=l.createEl("button",{cls:"weather-settings__table-button weather-settings__table-button--icon",text:"\u2193"});w.disabled=i===this.plugin.settings.temperatureGradient.length-1,w.addEventListener("click",()=>this.moveTemperatureStop(i,1)),l.createEl("button",{cls:"weather-settings__table-button",text:n.actions.remove}).addEventListener("click",()=>{this.plugin.settings.temperatureGradient.splice(i,1),this.plugin.saveSettings(),this.display()})}sortTemperatureGradient(){this.plugin.settings.temperatureGradient.sort((e,t)=>e.temperature-t.temperature),this.plugin.saveSettings(),this.display()}moveTemperatureStop(e,t){let i=e+t;if(i<0||i>=this.plugin.settings.temperatureGradient.length)return;let n=this.plugin.settings.temperatureGradient;[n[e],n[i]]=[n[i],n[e]],this.plugin.saveSettings(),this.display()}renderSunLayerSection(e,t){let i=e.createDiv({cls:"weather-settings__section"});i.createEl("h3",{text:t.settings.sunLayer.heading}),i.createEl("p",{text:t.settings.sunLayer.description,cls:"weather-settings__hint"});let n=i.createDiv({cls:"weather-settings__color-grid"});[{key:"sunrise",label:t.settings.sunLayer.sunriseColor},{key:"day",label:t.settings.sunLayer.dayColor},{key:"night",label:t.settings.sunLayer.nightColor}].forEach(({key:a,label:r})=>{new C.Setting(n).setName(r).addColorPicker(g=>g.setValue(this.plugin.settings.sunLayer.colors[a]).onChange(u=>{this.plugin.settings.sunLayer.colors[a]=u,this.plugin.saveSettings()}))}),this.addNumberSetting(i,t.settings.sunLayer.transitionLabel,this.plugin.settings.sunLayer.transitionMinutes,a=>{let r=Math.max(1,Math.round(a));return this.plugin.settings.sunLayer.transitionMinutes=r,r},{min:1,step:"1"}),this.addNumberSetting(i,t.settings.sunLayer.widthLabel,this.plugin.settings.sunLayer.width,a=>{let r=Math.max(1,Math.round(a));return this.plugin.settings.sunLayer.width=r,r},{min:1,step:"1"}),this.addNumberSetting(i,t.settings.sunLayer.softnessInnerLabel,this.plugin.settings.sunLayer.softnessInner,a=>{let r=Math.max(0,Math.min(1,a));return this.plugin.settings.sunLayer.softnessInner=r,r},{min:0,max:1,step:"0.05"}),this.addNumberSetting(i,t.settings.sunLayer.softnessOuterLabel,this.plugin.settings.sunLayer.softnessOuter,a=>{let r=Math.max(0,Math.min(1,a));return this.plugin.settings.sunLayer.softnessOuter=r,r},{min:0,max:1,step:"0.05"}),this.addNumberSetting(i,t.settings.sunLayer.twilightHighlightLabel,this.plugin.settings.sunLayer.twilightHighlight,a=>{let r=Math.max(0,Math.min(1,a));return this.plugin.settings.sunLayer.twilightHighlight=r,r},{min:0,max:1,step:"0.01"}),this.addNumberSetting(i,t.settings.sunLayer.dayHighlightLabel,this.plugin.settings.sunLayer.dayHighlight,a=>{let r=Math.max(0,Math.min(1,a));return this.plugin.settings.sunLayer.dayHighlight=r,r},{min:0,max:1,step:"0.01"}),this.addNumberSetting(i,t.settings.sunLayer.nightHighlightLabel,this.plugin.settings.sunLayer.nightHighlight,a=>{let r=Math.max(0,Math.min(1,a));return this.plugin.settings.sunLayer.nightHighlight=r,r},{min:0,max:1,step:"0.01"}),this.renderAlphaInputs(i,t.settings.sunLayer.dayAlphaLabel,this.plugin.settings.sunLayer.alphaDay),this.renderAlphaInputs(i,t.settings.sunLayer.nightAlphaLabel,this.plugin.settings.sunLayer.alphaNight)}renderAlphaInputs(e,t,i){new C.Setting(e).setName(t).addText(n=>{n.inputEl.type="number",n.inputEl.step="0.01",n.setValue(String(i.peak)),n.onChange(a=>{let r=Number(a);Number.isFinite(r)&&(i.peak=Math.max(0,Math.min(1,r)),n.setValue(String(i.peak)),this.plugin.saveSettings())})}).addText(n=>{n.inputEl.type="number",n.inputEl.step="0.01",n.setValue(String(i.mid)),n.onChange(a=>{let r=Number(a);Number.isFinite(r)&&(i.mid=Math.max(0,Math.min(1,r)),n.setValue(String(i.mid)),this.plugin.saveSettings())})}).addText(n=>{n.inputEl.type="number",n.inputEl.step="0.01",n.setValue(String(i.low)),n.onChange(a=>{let r=Number(a);Number.isFinite(r)&&(i.low=Math.max(0,Math.min(1,r)),n.setValue(String(i.low)),this.plugin.saveSettings())})})}renderGradientSection(e,t){let i=e.createDiv({cls:"weather-settings__section"});i.createEl("h3",{text:t.settings.gradients.heading}),i.createEl("p",{text:t.settings.gradients.description,cls:"weather-settings__hint"}),this.renderTimeGradientSection(i,t),this.renderWeatherGradientSection(i,t),this.renderTemperatureGradientControls(i,t)}renderTimeGradientSection(e,t){let i=this.createGradientPreview(e),n=()=>{i.style.backgroundImage=this.buildTimeGradientPreview(),i.style.backgroundColor=b(this.plugin.settings.timeBaseColors.day,"#87CEEB")};this.updateTimeGradientPreview=n,n(),this.addNumberSetting(e,t.settings.gradients.time.mixRatio,this.plugin.settings.gradients.timeBlend.mixRatio,a=>{let r=Math.max(0,Math.min(1,a));return this.plugin.settings.gradients.timeBlend.mixRatio=r,r},{min:0,max:1,step:"0.01",onChange:n}),this.addNumberSetting(e,t.settings.gradients.time.padding,this.plugin.settings.gradients.timeBlend.padding,a=>{let r=Math.max(0,a);return this.plugin.settings.gradients.timeBlend.padding=r,r},{min:0,step:"0.01",onChange:n}),this.addNumberSetting(e,t.settings.gradients.time.widthMin,this.plugin.settings.gradients.timeBlend.widthMin,a=>{let r=Math.max(0,a);return this.plugin.settings.gradients.timeBlend.widthMin=r,r},{min:0,step:"0.01",onChange:n}),this.addNumberSetting(e,t.settings.gradients.time.widthMax,this.plugin.settings.gradients.timeBlend.widthMax,a=>{let r=Math.max(this.plugin.settings.gradients.timeBlend.widthMin,a);return this.plugin.settings.gradients.timeBlend.widthMax=r,r},{min:0,step:"0.01",onChange:n}),this.addNumberSetting(e,t.settings.gradients.time.peakAlpha,this.plugin.settings.gradients.timeBlend.peakAlpha,a=>{let r=Math.max(0,Math.min(1,a));return this.plugin.settings.gradients.timeBlend.peakAlpha=r,r},{min:0,max:1,step:"0.01",onChange:n}),this.addNumberSetting(e,t.settings.gradients.time.edgeAlpha,this.plugin.settings.gradients.timeBlend.edgeAlpha,a=>{let r=Math.max(0,Math.min(1,a));return this.plugin.settings.gradients.timeBlend.edgeAlpha=r,r},{min:0,max:1,step:"0.01",onChange:n}),this.addNumberSetting(e,t.settings.gradients.time.steps,this.plugin.settings.gradients.timeBlend.steps,a=>{let r=Math.max(0,Math.round(a));return this.plugin.settings.gradients.timeBlend.steps=r,r},{min:0,step:"1",onChange:n}),this.addNumberSetting(e,t.settings.gradients.time.power,this.plugin.settings.gradients.timeBlend.power,a=>{let r=Math.max(.1,a);return this.plugin.settings.gradients.timeBlend.power=r,r},{min:.1,step:"0.01",onChange:n})}renderWeatherGradientSection(e,t){let i=this.createGradientPreview(e),n=()=>{i.style.backgroundImage=this.buildWeatherGradientPreview(),i.style.backgroundColor=b(this.plugin.settings.categoryStyles[Me].color,"#60a5fa")};this.updateWeatherGradientPreview=n,n(),this.addNumberSetting(e,t.settings.gradients.weather.padding,this.plugin.settings.gradients.weather.padding,a=>{let r=Math.max(0,a);return this.plugin.settings.gradients.weather.padding=r,r},{min:0,step:"0.01",onChange:n}),this.addNumberSetting(e,t.settings.gradients.weather.widthMin,this.plugin.settings.gradients.weather.widthMin,a=>{let r=Math.max(0,a);return this.plugin.settings.gradients.weather.widthMin=r,r},{min:0,step:"0.01",onChange:n}),this.addNumberSetting(e,t.settings.gradients.weather.widthMax,this.plugin.settings.gradients.weather.widthMax,a=>{let r=Math.max(this.plugin.settings.gradients.weather.widthMin,a);return this.plugin.settings.gradients.weather.widthMax=r,r},{min:0,step:"0.01",onChange:n}),this.addNumberSetting(e,t.settings.gradients.weather.peakScale,this.plugin.settings.gradients.weather.peakScale,a=>{let r=Math.max(0,a);return this.plugin.settings.gradients.weather.peakScale=r,r},{min:0,step:"0.01",onChange:n}),this.addNumberSetting(e,t.settings.gradients.weather.edgeScale,this.plugin.settings.gradients.weather.edgeScale,a=>{let r=Math.max(0,a);return this.plugin.settings.gradients.weather.edgeScale=r,r},{min:0,step:"0.01",onChange:n}),this.addNumberSetting(e,t.settings.gradients.weather.steps,this.plugin.settings.gradients.weather.steps,a=>{let r=Math.max(0,Math.round(a));return this.plugin.settings.gradients.weather.steps=r,r},{min:0,step:"1",onChange:n}),this.addNumberSetting(e,t.settings.gradients.weather.power,this.plugin.settings.gradients.weather.power,a=>{let r=Math.max(.1,a);return this.plugin.settings.gradients.weather.power=r,r},{min:.1,step:"0.01",onChange:n})}renderTemperatureGradientControls(e,t){let i=this.createGradientPreview(e),n=()=>{i.style.backgroundImage=this.buildTemperatureGradientPreview(),i.style.backgroundColor=b(Ve($e,this.plugin.settings.temperatureGradient),"#9ca3af")};this.updateTemperatureGradientPreview=n,n(),this.addNumberSetting(e,t.settings.gradients.temperature.start,this.plugin.settings.gradients.temperature.start,a=>{let r=Math.max(0,Math.min(1,a));return this.plugin.settings.gradients.temperature.start=r,r},{min:0,max:1,step:"0.01",onChange:n}),this.addNumberSetting(e,t.settings.gradients.temperature.end,this.plugin.settings.gradients.temperature.end,a=>{let r=Math.max(this.plugin.settings.gradients.temperature.start,Math.min(1,a));return this.plugin.settings.gradients.temperature.end=r,r},{min:0,max:1,step:"0.01",onChange:n}),this.addNumberSetting(e,t.settings.gradients.temperature.peakAlpha,this.plugin.settings.gradients.temperature.peakAlpha,a=>{let r=Math.max(0,Math.min(1,a));return this.plugin.settings.gradients.temperature.peakAlpha=r,r},{min:0,max:1,step:"0.01",onChange:n}),this.addNumberSetting(e,t.settings.gradients.temperature.edgeAlpha,this.plugin.settings.gradients.temperature.edgeAlpha,a=>{let r=Math.max(0,Math.min(1,a));return this.plugin.settings.gradients.temperature.edgeAlpha=r,r},{min:0,max:1,step:"0.01",onChange:n}),this.addNumberSetting(e,t.settings.gradients.temperature.steps,this.plugin.settings.gradients.temperature.steps,a=>{let r=Math.max(0,Math.round(a));return this.plugin.settings.gradients.temperature.steps=r,r},{min:0,step:"1",onChange:n}),this.addNumberSetting(e,t.settings.gradients.temperature.power,this.plugin.settings.gradients.temperature.power,a=>{let r=Math.max(.1,a);return this.plugin.settings.gradients.temperature.power=r,r},{min:.1,step:"0.01",onChange:n})}createGradientPreview(e){return e.createDiv({cls:"weather-settings__gradient-preview"})}buildTimeGradientPreview(){let e=this.plugin.settings,t=e.daySpan.min,i=e.daySpan.max,n=Math.max(1e-4,i-t),a=y(Oe,t,i),r=y((a-t)/n,0,1),g=y(ze,0,Math.max(0,1-a)),u=y(g+a,0,1),l=e.gradients.timeBlend.padding*N(e.gradients.timeBlend.widthMin,e.gradients.timeBlend.widthMax,r),d=y(g-a*l,0,1),w=y(u+a*l,0,1),p=b(e.timeBaseColors.day,"#87CEEB"),m=b(e.categoryStyles[Me].color,"#60a5fa"),h=x(p,m,e.gradients.timeBlend.mixRatio);return Le(h,d,w,e.gradients.timeBlend.peakAlpha,e.gradients.timeBlend.edgeAlpha,e.gradients.timeBlend.steps,e.gradients.timeBlend.power)}buildWeatherGradientPreview(){let e=this.plugin.settings,t=e.gradients.weather,i=e.daySpan.min,n=e.daySpan.max,a=Math.max(1e-4,n-i),r=y(Oe,i,n),g=y((r-i)/a,0,1),u=y(ze,0,Math.max(0,1-r)),l=y(u+r,0,1),d=t.padding*N(t.widthMin,t.widthMax,g),w=y(u-r*d,0,1),p=y(l+r*d,0,1),m=b(e.categoryStyles[Me].color,"#60a5fa"),h=.9*t.peakScale,v=h*.12*t.edgeScale;return Le(m,w,p,h,v,t.steps,t.power)}buildTemperatureGradientPreview(){let e=this.plugin.settings,t=e.gradients.temperature,i=Ve($e,e.temperatureGradient);return Le(i,y(t.start,0,1),y(t.end,0,1),y(t.peakAlpha,0,1),y(t.edgeAlpha,0,1),t.steps,t.power)}renderDisplaySection(e,t){let i=e.createDiv({cls:"weather-settings__section"});i.createEl("h3",{text:t.settings.display.heading}),i.createEl("p",{text:t.settings.display.description,cls:"weather-settings__hint"}),this.addNumberSetting(i,t.settings.display.verticalFadeTop,this.plugin.settings.verticalFade.top,n=>{let a=Math.max(0,Math.min(1,n));return this.plugin.settings.verticalFade.top=a,a},{min:0,max:1,step:"0.01"}),this.addNumberSetting(i,t.settings.display.verticalFadeMiddle,this.plugin.settings.verticalFade.middle,n=>{let a=Math.max(0,Math.min(1,n));return this.plugin.settings.verticalFade.middle=a,a},{min:0,max:1,step:"0.01"}),this.addNumberSetting(i,t.settings.display.leftPanelWidth,this.plugin.settings.leftPanel.width,n=>{let a=Math.max(0,n);return this.plugin.settings.leftPanel.width=a,a},{min:0,step:"1"}),this.addNumberSetting(i,t.settings.display.leftPanelHighlight,this.plugin.settings.leftPanel.minHighlight,n=>{let a=Math.max(0,Math.min(1,n));return this.plugin.settings.leftPanel.minHighlight=a,a},{min:0,max:1,step:"0.01"}),this.addNumberSetting(i,t.settings.display.daySpanMin,this.plugin.settings.daySpan.min,n=>{let a=Math.max(0,Math.min(this.plugin.settings.daySpan.max,n));return this.plugin.settings.daySpan.min=a,a},{min:0,max:1,step:"0.01"}),this.addNumberSetting(i,t.settings.display.daySpanMax,this.plugin.settings.daySpan.max,n=>{let a=Math.max(this.plugin.settings.daySpan.min,Math.min(1,n));return this.plugin.settings.daySpan.max=a,a},{min:0,max:1,step:"0.01"}),new C.Setting(i).setName(t.settings.display.showDateLabel).setDesc(t.settings.display.showDateDescription).addToggle(n=>{n.setValue(this.plugin.settings.showDateWhenDifferent),n.onChange(a=>{this.plugin.settings.showDateWhenDifferent=a,this.plugin.saveSettings()})})}addNumberSetting(e,t,i,n,a={}){let r=new C.Setting(e).setName(t);a.desc&&r.setDesc(a.desc),r.addText(g=>{g.inputEl.type="number",a.min!=null&&(g.inputEl.min=String(a.min)),a.max!=null&&(g.inputEl.max=String(a.max)),a.step!=null&&(g.inputEl.step=a.step),g.setValue(String(i)),g.onChange(u=>{var d;let l=Number(u);if(Number.isFinite(l)){let w=n(l);g.setValue(String(w)),this.plugin.saveSettings(),(d=a.onChange)==null||d.call(a)}})})}};var Ue=require("obsidian");var $="weather-widget",oe=class extends Ue.ItemView{constructor(e,t){super(e);this.plugin=t,this.widget=new Y(t)}getViewType(){return $}getDisplayText(){return this.plugin.getStrings().view.title}getIcon(){return"cloud"}async onOpen(){this.widget.mount(this.containerEl)}async onClose(){this.containerEl.empty()}refresh(){this.widget.update()}};var Ke="ru";var Ye={en:{languageNames:{en:"English",ru:"Russian"},settings:{localization:{heading:"Localization",languageLabel:"Interface language",languageDescription:"Switch the plugin UI between Russian and English."},refresh:{heading:"Updates",description:"Choose how often the plugin refreshes weather data and how long cached responses stay valid.",autoRefreshLabel:"Refresh interval (minutes)",autoRefreshDescription:"The widget asks the weather service on this cadence.",cacheLabel:"Cache lifetime (minutes)",cacheDescription:"Avoid excessive requests by reusing recent data."},locations:{heading:"Locations",description:"Add the places you want to monitor. Use decimal degrees for coordinates.",tableHeaders:{label:"Label",latitude:"Latitude",longitude:"Longitude",actions:""},addButtonLabel:"Add location",emptyState:"No locations configured yet.",defaultLabel:"New location"},timePalette:{heading:"Time-of-day colors",description:"Tune base and highlight colors used for sunrise, day, evening, and night."},weatherPalette:{heading:"Weather palette",description:"Pick the color and icon for each weather category."},temperatureGradient:{heading:"Temperature gradient",description:"Define color stops that map to specific \xB0C values.",addButtonLabel:"Add stop",tableHeaders:{temperature:"Temperature (\xB0C)",color:"Color"}},sunLayer:{heading:"Sun overlay",description:"Control the glowing spotlight that represents the sun's position.",sunriseColor:"Sunrise color",dayColor:"Day color",nightColor:"Night color",transitionLabel:"Transition duration (minutes)",widthLabel:"Sun beam width",softnessInnerLabel:"Inner softness",softnessOuterLabel:"Outer softness",twilightHighlightLabel:"Twilight highlight",dayHighlightLabel:"Day highlight",nightHighlightLabel:"Night highlight",dayAlphaLabel:"Day opacity (peak / mid / low)",nightAlphaLabel:"Night opacity (peak / mid / low)"},gradients:{heading:"Layer gradients",description:"Fine tune how each background layer blends across the row.",time:{mixRatio:"Time layer mix ratio",padding:"Time layer padding",widthMin:"Time width minimum",widthMax:"Time width maximum",peakAlpha:"Time peak alpha",edgeAlpha:"Time edge alpha",steps:"Time gradient steps",power:"Time easing power"},weather:{padding:"Weather layer padding",widthMin:"Weather width minimum",widthMax:"Weather width maximum",peakScale:"Weather peak scale",edgeScale:"Weather edge scale",steps:"Weather gradient steps",power:"Weather easing power"},temperature:{start:"Temperature gradient start",end:"Temperature gradient end",peakAlpha:"Temperature peak alpha",edgeAlpha:"Temperature edge alpha",steps:"Temperature gradient steps",power:"Temperature easing power"}},display:{heading:"Display",description:"Adjust auxiliary effects and date behaviour.",verticalFadeTop:"Vertical fade (top)",verticalFadeMiddle:"Vertical fade (middle)",leftPanelWidth:"Highlight panel width",leftPanelHighlight:"Minimum highlight intensity",daySpanMin:"Minimum day span",daySpanMax:"Maximum day span",showDateLabel:"Show date when different",showDateDescription:"Append the local date whenever it differs from your current day."}},actions:{remove:"Remove",moveUp:"Move up",moveDown:"Move down",reset:"Reset"},sunPhases:{morning:"Morning",day:"Day",evening:"Evening",night:"Night"},weatherConditions:{sunny:"Sunny",cloudy:"Cloudy",rainy:"Rain",snowy:"Snow",drizzle:"Drizzle",storm:"Thunderstorm",foggy:"Fog"},notices:{openCanvasFirst:"Open a Canvas file before inserting the widget.",canvasCreationFailed:"Unable to create a Canvas node. Please verify your Obsidian version.",canvasPlaceholderAdded:"Widget placeholder added to the Canvas."},widget:{forecastPlaceholder:"Forecast will appear here",loadingLabel:"Loading..."},markdown:{debugParameters:"TODO: handle block parameters - "},commands:{openTab:"Open weather widget tab",insertCanvas:"Add weather widget to Canvas"},view:{title:"Weather widget"}},ru:{languageNames:{en:"\u0410\u043D\u0433\u043B\u0438\u0439\u0441\u043A\u0438\u0439",ru:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439"},settings:{localization:{heading:"\u041B\u043E\u043A\u0430\u043B\u0438\u0437\u0430\u0446\u0438\u044F",languageLabel:"\u042F\u0437\u044B\u043A \u0438\u043D\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430",languageDescription:"\u041F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0430\u0439\u0442\u0435 \u043F\u043B\u0430\u0433\u0438\u043D \u043C\u0435\u0436\u0434\u0443 \u0440\u0443\u0441\u0441\u043A\u0438\u043C \u0438 \u0430\u043D\u0433\u043B\u0438\u0439\u0441\u043A\u0438\u043C \u044F\u0437\u044B\u043A\u0430\u043C\u0438."},refresh:{heading:"\u041E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0435",description:"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u0442\u0435 \u0447\u0430\u0441\u0442\u043E\u0442\u0443 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F \u0438 \u0432\u0440\u0435\u043C\u044F \u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F \u0437\u0430\u043A\u044D\u0448\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u044B\u0445 \u0434\u0430\u043D\u043D\u044B\u0445.",autoRefreshLabel:"\u0418\u043D\u0442\u0435\u0440\u0432\u0430\u043B \u0437\u0430\u043F\u0440\u043E\u0441\u0430 (\u043C\u0438\u043D)",autoRefreshDescription:"\u0421 \u043A\u0430\u043A\u043E\u0439 \u043F\u0435\u0440\u0438\u043E\u0434\u0438\u0447\u043D\u043E\u0441\u0442\u044C\u044E \u0432\u0438\u0434\u0436\u0435\u0442 \u043E\u0431\u0440\u0430\u0449\u0430\u0435\u0442\u0441\u044F \u043A \u0441\u0435\u0440\u0432\u0438\u0441\u0443 \u043F\u043E\u0433\u043E\u0434\u044B.",cacheLabel:"\u0412\u0440\u0435\u043C\u044F \u0436\u0438\u0437\u043D\u0438 \u043A\u0435\u0448\u0430 (\u043C\u0438\u043D)",cacheDescription:"\u041F\u0435\u0440\u0435\u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0439\u0442\u0435 \u0441\u0432\u0435\u0436\u0438\u0435 \u043E\u0442\u0432\u0435\u0442\u044B, \u0447\u0442\u043E\u0431\u044B \u043D\u0435 \u043F\u0435\u0440\u0435\u0433\u0440\u0443\u0436\u0430\u0442\u044C API."},locations:{heading:"\u041B\u043E\u043A\u0430\u0446\u0438\u0438",description:"\u0414\u043E\u0431\u0430\u0432\u044C\u0442\u0435 \u0438\u043D\u0442\u0435\u0440\u0435\u0441\u0443\u044E\u0449\u0438\u0435 \u0432\u0430\u0441 \u0433\u043E\u0440\u043E\u0434\u0430. \u041A\u043E\u043E\u0440\u0434\u0438\u043D\u0430\u0442\u044B \u0443\u043A\u0430\u0437\u044B\u0432\u0430\u0439\u0442\u0435 \u0432 \u0433\u0440\u0430\u0434\u0443\u0441\u0430\u0445 \u0441 \u0434\u0435\u0441\u044F\u0442\u0438\u0447\u043D\u043E\u0439 \u0447\u0430\u0441\u0442\u044C\u044E.",tableHeaders:{label:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",latitude:"\u0428\u0438\u0440\u043E\u0442\u0430",longitude:"\u0414\u043E\u043B\u0433\u043E\u0442\u0430",actions:""},addButtonLabel:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043B\u043E\u043A\u0430\u0446\u0438\u044E",emptyState:"\u041B\u043E\u043A\u0430\u0446\u0438\u0438 \u043F\u043E\u043A\u0430 \u043D\u0435 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u044B.",defaultLabel:"\u041D\u043E\u0432\u0430\u044F \u043B\u043E\u043A\u0430\u0446\u0438\u044F"},timePalette:{heading:"\u0426\u0432\u0435\u0442\u0430 \u043F\u043E \u0432\u0440\u0435\u043C\u0435\u043D\u0438 \u0441\u0443\u0442\u043E\u043A",description:"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u0442\u0435 \u043E\u0441\u043D\u043E\u0432\u043D\u0443\u044E \u0438 \u0430\u043A\u0446\u0435\u043D\u0442\u043D\u0443\u044E \u043F\u0430\u043B\u0438\u0442\u0440\u0443 \u0434\u043B\u044F \u0440\u0430\u0441\u0441\u0432\u0435\u0442\u0430, \u0434\u043D\u044F, \u0432\u0435\u0447\u0435\u0440\u0430 \u0438 \u043D\u043E\u0447\u0438."},weatherPalette:{heading:"\u0426\u0432\u0435\u0442\u0430 \u043F\u043E\u0433\u043E\u0434\u043D\u044B\u0445 \u0443\u0441\u043B\u043E\u0432\u0438\u0439",description:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0446\u0432\u0435\u0442 \u0438 \u0438\u043A\u043E\u043D\u043A\u0443 \u0434\u043B\u044F \u043A\u0430\u0436\u0434\u043E\u0433\u043E \u0442\u0438\u043F\u0430 \u043F\u043E\u0433\u043E\u0434\u044B."},temperatureGradient:{heading:"\u0413\u0440\u0430\u0434\u0438\u0435\u043D\u0442 \u0442\u0435\u043C\u043F\u0435\u0440\u0430\u0442\u0443\u0440",description:"\u041E\u043F\u0440\u0435\u0434\u0435\u043B\u0438\u0442\u0435 \u0441\u043E\u043E\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435 \u0446\u0432\u0435\u0442\u043E\u0432 \u0438 \u0442\u0435\u043C\u043F\u0435\u0440\u0430\u0442\u0443\u0440 (\xB0C).",addButtonLabel:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0442\u043E\u0447\u043A\u0443",tableHeaders:{temperature:"\u0422\u0435\u043C\u043F\u0435\u0440\u0430\u0442\u0443\u0440\u0430 (\xB0C)",color:"\u0426\u0432\u0435\u0442"}},sunLayer:{heading:"\u0421\u043E\u043B\u043D\u0435\u0447\u043D\u043E\u0435 \u0441\u0432\u0435\u0447\u0435\u043D\u0438\u0435",description:"\u041F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B \u0441\u0432\u0435\u0442\u043E\u0432\u043E\u0433\u043E \u043F\u044F\u0442\u043D\u0430, \u043F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u044E\u0449\u0435\u0433\u043E \u043F\u043E\u043B\u043E\u0436\u0435\u043D\u0438\u0435 \u0441\u043E\u043B\u043D\u0446\u0430.",sunriseColor:"\u0426\u0432\u0435\u0442 \u0440\u0430\u0441\u0441\u0432\u0435\u0442\u0430",dayColor:"\u0414\u043D\u0435\u0432\u043D\u043E\u0439 \u0446\u0432\u0435\u0442",nightColor:"\u041D\u043E\u0447\u043D\u043E\u0439 \u0446\u0432\u0435\u0442",transitionLabel:"\u0414\u043B\u0438\u0442\u0435\u043B\u044C\u043D\u043E\u0441\u0442\u044C \u043F\u0435\u0440\u0435\u0445\u043E\u0434\u0430 (\u043C\u0438\u043D)",widthLabel:"\u0428\u0438\u0440\u0438\u043D\u0430 \u043B\u0443\u0447\u0430",softnessInnerLabel:"\u041C\u044F\u0433\u043A\u043E\u0441\u0442\u044C \u0432\u043D\u0443\u0442\u0440\u0438",softnessOuterLabel:"\u041C\u044F\u0433\u043A\u043E\u0441\u0442\u044C \u0441\u043D\u0430\u0440\u0443\u0436\u0438",twilightHighlightLabel:"\u041F\u043E\u0434\u0441\u0432\u0435\u0442\u043A\u0430 \u0441\u0443\u043C\u0435\u0440\u0435\u043A",dayHighlightLabel:"\u041F\u043E\u0434\u0441\u0432\u0435\u0442\u043A\u0430 \u0434\u043D\u044F",nightHighlightLabel:"\u041F\u043E\u0434\u0441\u0432\u0435\u0442\u043A\u0430 \u043D\u043E\u0447\u0438",dayAlphaLabel:"\u042F\u0440\u043A\u043E\u0441\u0442\u044C \u0434\u043D\u044F (\u043F\u0438\u043A / \u0441\u0435\u0440\u0435\u0434\u0438\u043D\u0430 / \u043A\u0440\u0430\u044F)",nightAlphaLabel:"\u042F\u0440\u043A\u043E\u0441\u0442\u044C \u043D\u043E\u0447\u0438 (\u043F\u0438\u043A / \u0441\u0435\u0440\u0435\u0434\u0438\u043D\u0430 / \u043A\u0440\u0430\u044F)"},gradients:{heading:"\u0413\u0440\u0430\u0434\u0438\u0435\u043D\u0442\u044B \u0441\u043B\u043E\u0451\u0432",description:"\u0422\u043E\u043D\u043A\u0430\u044F \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430 \u043D\u0430\u043B\u043E\u0436\u0435\u043D\u0438\u044F \u0444\u043E\u043D\u043E\u0432 \u0432 \u043A\u0430\u0436\u0434\u043E\u0439 \u0441\u0442\u0440\u043E\u043A\u0435.",time:{mixRatio:"\u0421\u043C\u0435\u0448\u0435\u043D\u0438\u0435 \u0441\u043B\u043E\u044F \u0432\u0440\u0435\u043C\u0435\u043D\u0438",padding:"\u041E\u0442\u0441\u0442\u0443\u043F \u0441\u043B\u043E\u044F \u0432\u0440\u0435\u043C\u0435\u043D\u0438",widthMin:"\u041C\u0438\u043D\u0438\u043C\u0430\u043B\u044C\u043D\u0430\u044F \u0448\u0438\u0440\u0438\u043D\u0430",widthMax:"\u041C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u0430\u044F \u0448\u0438\u0440\u0438\u043D\u0430",peakAlpha:"\u041F\u0438\u043A\u043E\u0432\u0430\u044F \u043D\u0435\u043F\u0440\u043E\u0437\u0440\u0430\u0447\u043D\u043E\u0441\u0442\u044C",edgeAlpha:"\u041D\u0435\u043F\u0440\u043E\u0437\u0440\u0430\u0447\u043D\u043E\u0441\u0442\u044C \u043A\u0440\u0430\u0451\u0432",steps:"\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u0448\u0430\u0433\u043E\u0432",power:"\u041A\u0440\u0438\u0432\u0430\u044F \u043E\u0441\u043B\u0430\u0431\u043B\u0435\u043D\u0438\u044F"},weather:{padding:"\u041E\u0442\u0441\u0442\u0443\u043F \u043F\u043E\u0433\u043E\u0434\u043D\u043E\u0433\u043E \u0441\u043B\u043E\u044F",widthMin:"\u041C\u0438\u043D. \u0448\u0438\u0440\u0438\u043D\u0430",widthMax:"\u041C\u0430\u043A\u0441. \u0448\u0438\u0440\u0438\u043D\u0430",peakScale:"\u041F\u0438\u043A\u043E\u0432\u044B\u0439 \u043C\u043D\u043E\u0436\u0438\u0442\u0435\u043B\u044C",edgeScale:"\u041C\u043D\u043E\u0436\u0438\u0442\u0435\u043B\u044C \u043A\u0440\u0430\u0451\u0432",steps:"\u0428\u0430\u0433\u043E\u0432",power:"\u041A\u0440\u0438\u0432\u0430\u044F \u043E\u0441\u043B\u0430\u0431\u043B\u0435\u043D\u0438\u044F"},temperature:{start:"\u041D\u0430\u0447\u0430\u043B\u043E \u0442\u0435\u043C\u043F\u0435\u0440\u0430\u0442\u0443\u0440\u043D\u043E\u0433\u043E \u0441\u043B\u043E\u044F",end:"\u041A\u043E\u043D\u0435\u0446 \u0442\u0435\u043C\u043F\u0435\u0440\u0430\u0442\u0443\u0440\u043D\u043E\u0433\u043E \u0441\u043B\u043E\u044F",peakAlpha:"\u041F\u0438\u043A\u043E\u0432\u0430\u044F \u043D\u0435\u043F\u0440\u043E\u0437\u0440\u0430\u0447\u043D\u043E\u0441\u0442\u044C",edgeAlpha:"\u041D\u0435\u043F\u0440\u043E\u0437\u0440\u0430\u0447\u043D\u043E\u0441\u0442\u044C \u043A\u0440\u0430\u0451\u0432",steps:"\u0428\u0430\u0433\u043E\u0432",power:"\u041A\u0440\u0438\u0432\u0430\u044F \u043E\u0441\u043B\u0430\u0431\u043B\u0435\u043D\u0438\u044F"}},display:{heading:"\u041E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435",description:"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u0442\u0435 \u0434\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u044D\u0444\u0444\u0435\u043A\u0442\u044B \u0438 \u043F\u043E\u0432\u0435\u0434\u0435\u043D\u0438\u0435 \u0434\u0430\u0442\u044B.",verticalFadeTop:"\u0412\u0435\u0440\u0442\u0438\u043A\u0430\u043B\u044C\u043D\u043E\u0435 \u0437\u0430\u0442\u0435\u043C\u043D\u0435\u043D\u0438\u0435 (\u0441\u0432\u0435\u0440\u0445\u0443)",verticalFadeMiddle:"\u0412\u0435\u0440\u0442\u0438\u043A\u0430\u043B\u044C\u043D\u043E\u0435 \u0437\u0430\u0442\u0435\u043C\u043D\u0435\u043D\u0438\u0435 (\u0446\u0435\u043D\u0442\u0440)",leftPanelWidth:"\u0428\u0438\u0440\u0438\u043D\u0430 \u043F\u043E\u0434\u0441\u0432\u0435\u0442\u043A\u0438 \u0441\u043B\u0435\u0432\u0430",leftPanelHighlight:"\u041C\u0438\u043D\u0438\u043C\u0430\u043B\u044C\u043D\u0430\u044F \u0438\u043D\u0442\u0435\u043D\u0441\u0438\u0432\u043D\u043E\u0441\u0442\u044C \u043F\u043E\u0434\u0441\u0432\u0435\u0442\u043A\u0438",daySpanMin:"\u041C\u0438\u043D. \u0434\u043E\u043B\u044F \u0434\u043D\u0435\u0432\u043D\u043E\u0433\u043E \u0432\u0440\u0435\u043C\u0435\u043D\u0438",daySpanMax:"\u041C\u0430\u043A\u0441. \u0434\u043E\u043B\u044F \u0434\u043D\u0435\u0432\u043D\u043E\u0433\u043E \u0432\u0440\u0435\u043C\u0435\u043D\u0438",showDateLabel:"\u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u0434\u0430\u0442\u0443, \u0435\u0441\u043B\u0438 \u043E\u0442\u043B\u0438\u0447\u0430\u0435\u0442\u0441\u044F",showDateDescription:"\u0414\u043E\u0431\u0430\u0432\u043B\u044F\u0442\u044C \u043B\u043E\u043A\u0430\u043B\u044C\u043D\u0443\u044E \u0434\u0430\u0442\u0443, \u043A\u043E\u0433\u0434\u0430 \u043E\u043D\u0430 \u043D\u0435 \u0441\u043E\u0432\u043F\u0430\u0434\u0430\u0435\u0442 \u0441 \u0442\u0435\u043A\u0443\u0449\u0435\u0439."}},actions:{remove:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",moveUp:"\u0412\u0432\u0435\u0440\u0445",moveDown:"\u0412\u043D\u0438\u0437",reset:"\u0421\u0431\u0440\u043E\u0441\u0438\u0442\u044C"},sunPhases:{morning:"\u0423\u0442\u0440\u043E",day:"\u0414\u0435\u043D\u044C",evening:"\u0412\u0435\u0447\u0435\u0440",night:"\u041D\u043E\u0447\u044C"},weatherConditions:{sunny:"\u042F\u0441\u043D\u043E",cloudy:"\u041E\u0431\u043B\u0430\u0447\u043D\u043E",rainy:"\u0414\u043E\u0436\u0434\u044C",snowy:"\u0421\u043D\u0435\u0433",drizzle:"\u041C\u043E\u0440\u043E\u0441\u044C",storm:"\u0413\u0440\u043E\u0437\u0430",foggy:"\u0422\u0443\u043C\u0430\u043D"},notices:{openCanvasFirst:"\u041E\u0442\u043A\u0440\u043E\u0439\u0442\u0435 Canvas \u043F\u0435\u0440\u0435\u0434 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0435\u043C \u0432\u0438\u0434\u0436\u0435\u0442\u0430.",canvasCreationFailed:"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0443\u0437\u0435\u043B Canvas. \u041F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435 \u0432\u0435\u0440\u0441\u0438\u044E Obsidian.",canvasPlaceholderAdded:"\u0417\u0430\u0433\u043B\u0443\u0448\u043A\u0430 \u0432\u0438\u0434\u0436\u0435\u0442\u0430 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0430 \u043D\u0430 Canvas."},widget:{forecastPlaceholder:"\u041F\u0440\u043E\u0433\u043D\u043E\u0437 \u043F\u043E\u044F\u0432\u0438\u0442\u0441\u044F \u0437\u0434\u0435\u0441\u044C",loadingLabel:"\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430..."},markdown:{debugParameters:"TODO: \u043E\u0431\u0440\u0430\u0431\u043E\u0442\u0430\u0442\u044C \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B \u0431\u043B\u043E\u043A\u0430 - "},commands:{openTab:"\u041E\u0442\u043A\u0440\u044B\u0442\u044C \u0432\u043A\u043B\u0430\u0434\u043A\u0443 \u0441 \u0432\u0438\u0434\u0436\u0435\u0442\u043E\u043C",insertCanvas:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0432\u0438\u0434\u0436\u0435\u0442 \u043D\u0430 Canvas"},view:{title:"\u041F\u043E\u0433\u043E\u0434\u043D\u044B\u0439 \u0432\u0438\u0434\u0436\u0435\u0442"}}};function je(s){var o;return(o=Ye[s])!=null?o:Ye[Ke]}var Rt="https://api.open-meteo.com/v1/forecast";function It(s){let o=new URLSearchParams({latitude:s.latitude.toString(),longitude:s.longitude.toString(),current:"temperature_2m,weather_code",daily:"sunrise,sunset",forecast_days:"1",timezone:"auto"});return`${Rt}?${o.toString()}`}var le=class{constructor(o=console){this.logger=o;this.cache=new Map;this.expiration=new Map}getSnapshot(o){let e=this.cache.get(o);if(!e)return;let t=this.expiration.get(o);if(t&&Date.now()>t){this.cache.delete(o),this.expiration.delete(o);return}return e}async refreshCity(o,e){var g,u,l,d,w,p,m,h,v;if(!Number.isFinite(o.latitude)||!Number.isFinite(o.longitude))return this.logger.warn("WeatherService: invalid coordinates provided",o),null;let t=Math.max(1,e),i=Date.now(),n=this.expiration.get(o.id),a=this.cache.get(o.id);if(a&&n&&i<n)return a;let r=It(o);try{let D=await fetch(r);if(!D.ok)throw new Error(`Open-Meteo response ${D.status}`);let f=await D.json(),V={cityId:o.id,fetchedAt:i,latitude:o.latitude,longitude:o.longitude,timezone:(g=f==null?void 0:f.timezone)!=null?g:null,sunrise:(d=(l=(u=f==null?void 0:f.daily)==null?void 0:u.sunrise)==null?void 0:l[0])!=null?d:null,sunset:(m=(p=(w=f==null?void 0:f.daily)==null?void 0:w.sunset)==null?void 0:p[0])!=null?m:null,temperature:typeof((h=f==null?void 0:f.current)==null?void 0:h.temperature_2m)=="number"?f.current.temperature_2m:null,weatherCode:typeof((v=f==null?void 0:f.current)==null?void 0:v.weather_code)=="number"?f.current.weather_code:null};return this.cache.set(o.id,V),this.expiration.set(o.id,i+t*6e4),V}catch(D){return this.logger.error("WeatherService: failed to fetch",o.label,D),a||null}}clear(){this.cache.clear(),this.expiration.clear()}};var Z=class extends qe.Plugin{constructor(){super(...arguments);this.canvasBridge=null;this.weatherData=new Map;this.refreshIntervalId=null}async onload(){this.weatherService=new le,await this.loadSettings(),this.registerView($,e=>new oe(e,this)),this.canvasBridge=new te(this),Be(this,this.canvasBridge),Ge(this),this.addSettingTab(new se(this.app,this)),await this.refreshWeatherData(),this.scheduleWeatherRefresh()}onunload(){var e,t;this.app.workspace.detachLeavesOfType($),(e=this.canvasBridge)==null||e.unregister(),this.refreshIntervalId!==null&&(window.clearInterval(this.refreshIntervalId),this.refreshIntervalId=null),(t=this.weatherService)==null||t.clear(),this.weatherData.clear()}async activateView(){var n;let{workspace:e}=this.app,t=e.getLeavesOfType($),i;t.length>0?[i]=t:(i=(n=e.getRightLeaf(!1))!=null?n:e.getLeaf(!0),await i.setViewState({type:$,active:!0})),e.revealLeaf(i)}requestWidgetRefresh(){this.app.workspace.getLeavesOfType($).forEach(e=>{e.view.refresh()})}getStrings(){return this.strings}getLocale(){return this.locale}getWeatherSnapshot(e){return this.weatherData.get(e)}applyLocalization(){this.locale=this.settings.language,this.strings=je(this.locale)}normalizeSettings(){var a,r,g,u;let e=O;if(Array.isArray(this.settings.cities)||(this.settings.cities=[]),this.settings.cities=this.settings.cities.map((l,d)=>{var D;let w=l,p=typeof w.label=="string"?w.label:w.name,m=typeof p=="string"&&p.trim().length>0?p.trim():`City ${d+1}`,h=Number(w.latitude),v=Number(w.longitude);return{id:(D=w.id)!=null?D:re("city"),label:m,latitude:Number.isFinite(h)?h:0,longitude:Number.isFinite(v)?v:0}}),Number.isFinite(this.settings.weatherCacheMinutes)||(this.settings.weatherCacheMinutes=e.weatherCacheMinutes),Number.isFinite(this.settings.autoRefreshMinutes)||(this.settings.autoRefreshMinutes=e.autoRefreshMinutes),this.settings.categoryStyles||(this.settings.categoryStyles={...e.categoryStyles}),ae.forEach(l=>{let d=this.settings.categoryStyles[l];if(!d){this.settings.categoryStyles[l]={...e.categoryStyles[l]};return}this.settings.categoryStyles[l]={color:typeof d.color=="string"&&d.color.trim().length>0?d.color.trim():e.categoryStyles[l].color,icon:typeof d.icon=="string"&&d.icon.trim().length>0?d.icon.trim():e.categoryStyles[l].icon}}),this.settings.timeBaseColors||(this.settings.timeBaseColors={...e.timeBaseColors}),X.forEach(l=>{let d=this.settings.timeBaseColors[l];this.settings.timeBaseColors[l]=typeof d=="string"&&d.trim().length>0?d.trim():e.timeBaseColors[l]}),this.settings.timeTintColors||(this.settings.timeTintColors={...e.timeTintColors}),X.forEach(l=>{let d=this.settings.timeTintColors[l];this.settings.timeTintColors[l]=typeof d=="string"&&d.trim().length>0?d.trim():e.timeTintColors[l]}),!this.settings.sunLayer)this.settings.sunLayer=JSON.parse(JSON.stringify(e.sunLayer));else{let{sunLayer:l}=this.settings,d=e.sunLayer;l.colors=(a=l.colors)!=null?a:{...d.colors},Object.keys(d.colors).forEach(p=>{let m=l.colors[p];l.colors[p]=typeof m=="string"&&m.trim().length>0?m.trim():d.colors[p]});let w=(p,m)=>({peak:Number.isFinite(p==null?void 0:p.peak)?Number(p==null?void 0:p.peak):m.peak,mid:Number.isFinite(p==null?void 0:p.mid)?Number(p==null?void 0:p.mid):m.mid,low:Number.isFinite(p==null?void 0:p.low)?Number(p==null?void 0:p.low):m.low});l.alphaDay=w(l.alphaDay,d.alphaDay),l.alphaNight=w(l.alphaNight,d.alphaNight),l.transitionMinutes=Number.isFinite(l.transitionMinutes)?l.transitionMinutes:d.transitionMinutes,l.width=Number.isFinite(l.width)?l.width:d.width,l.softnessInner=Number.isFinite(l.softnessInner)?l.softnessInner:d.softnessInner,l.softnessOuter=Number.isFinite(l.softnessOuter)?l.softnessOuter:d.softnessOuter,l.twilightHighlight=Number.isFinite(l.twilightHighlight)?l.twilightHighlight:d.twilightHighlight,l.dayHighlight=Number.isFinite(l.dayHighlight)?l.dayHighlight:d.dayHighlight,l.nightHighlight=Number.isFinite(l.nightHighlight)?l.nightHighlight:d.nightHighlight}if(!this.settings.gradients)this.settings.gradients=JSON.parse(JSON.stringify(e.gradients));else{let l=this.settings.gradients,d=e.gradients,w=()=>{var v;let h=(v=l.timeBlend)!=null?v:{...d.timeBlend};h.mixRatio=Number.isFinite(h.mixRatio)?h.mixRatio:d.timeBlend.mixRatio,h.padding=Number.isFinite(h.padding)?h.padding:d.timeBlend.padding,h.widthMin=Number.isFinite(h.widthMin)?h.widthMin:d.timeBlend.widthMin,h.widthMax=Number.isFinite(h.widthMax)?h.widthMax:d.timeBlend.widthMax,h.peakAlpha=Number.isFinite(h.peakAlpha)?h.peakAlpha:d.timeBlend.peakAlpha,h.edgeAlpha=Number.isFinite(h.edgeAlpha)?h.edgeAlpha:d.timeBlend.edgeAlpha,h.steps=Number.isFinite(h.steps)?h.steps:d.timeBlend.steps,h.power=Number.isFinite(h.power)?h.power:d.timeBlend.power,l.timeBlend=h},p=()=>{var v;let h=(v=l.weather)!=null?v:{...d.weather};h.padding=Number.isFinite(h.padding)?h.padding:d.weather.padding,h.widthMin=Number.isFinite(h.widthMin)?h.widthMin:d.weather.widthMin,h.widthMax=Number.isFinite(h.widthMax)?h.widthMax:d.weather.widthMax,h.peakScale=Number.isFinite(h.peakScale)?h.peakScale:d.weather.peakScale,h.edgeScale=Number.isFinite(h.edgeScale)?h.edgeScale:d.weather.edgeScale,h.steps=Number.isFinite(h.steps)?h.steps:d.weather.steps,h.power=Number.isFinite(h.power)?h.power:d.weather.power,l.weather=h},m=()=>{var v;let h=(v=l.temperature)!=null?v:{...d.temperature};h.start=Number.isFinite(h.start)?h.start:d.temperature.start,h.end=Number.isFinite(h.end)?h.end:d.temperature.end,h.peakAlpha=Number.isFinite(h.peakAlpha)?h.peakAlpha:d.temperature.peakAlpha,h.edgeAlpha=Number.isFinite(h.edgeAlpha)?h.edgeAlpha:d.temperature.edgeAlpha,h.steps=Number.isFinite(h.steps)?h.steps:d.temperature.steps,h.power=Number.isFinite(h.power)?h.power:d.temperature.power,l.temperature=h};w(),p(),m()}let t=(r=this.settings.verticalFade)!=null?r:{...e.verticalFade};t.top=Number.isFinite(t.top)?t.top:e.verticalFade.top,t.middle=Number.isFinite(t.middle)?t.middle:e.verticalFade.middle,this.settings.verticalFade=t;let i=(g=this.settings.leftPanel)!=null?g:{...e.leftPanel};i.width=Number.isFinite(i.width)?i.width:e.leftPanel.width,i.minHighlight=Number.isFinite(i.minHighlight)?i.minHighlight:e.leftPanel.minHighlight,this.settings.leftPanel=i;let n=(u=this.settings.daySpan)!=null?u:{...e.daySpan};n.min=Number.isFinite(n.min)?n.min:e.daySpan.min,n.max=Number.isFinite(n.max)?n.max:e.daySpan.max,this.settings.daySpan=n,Array.isArray(this.settings.temperatureGradient)?this.settings.temperatureGradient=this.settings.temperatureGradient.map(l=>{var d,w;return{temperature:Number.isFinite(l.temperature)?l.temperature:0,color:typeof l.color=="string"&&l.color.trim().length>0?l.color.trim():(w=(d=e.temperatureGradient[0])==null?void 0:d.color)!=null?w:"#9CA3AF"}}).sort((l,d)=>l.temperature-d.temperature):this.settings.temperatureGradient=[...e.temperatureGradient],this.settings.showDateWhenDifferent=Boolean(this.settings.showDateWhenDifferent)}async loadSettings(){let e=await this.loadData();this.settings=Object.assign({},O,e!=null?e:{}),this.normalizeSettings(),this.applyLocalization()}async saveSettings(){this.normalizeSettings(),await this.saveData(this.settings),this.applyLocalization(),this.requestWidgetRefresh(),this.scheduleWeatherRefresh(),await this.refreshWeatherData(),this.requestWidgetRefresh()}scheduleWeatherRefresh(){this.refreshIntervalId!==null&&(window.clearInterval(this.refreshIntervalId),this.refreshIntervalId=null);let t=Math.max(1,this.settings.autoRefreshMinutes)*6e4,i=window.setInterval(()=>{this.refreshWeatherData()},t);this.refreshIntervalId=i,this.registerInterval(i)}async refreshWeatherData(){if(this.settings.cities.length===0){this.weatherData.clear();return}let e=!1;for(let t of this.settings.cities){let i=await this.weatherService.refreshCity(t,this.settings.weatherCacheMinutes);i&&(this.weatherData.set(t.id,i),e=!0)}e&&this.requestWidgetRefresh()}};
