# Weather Widget для Obsidian

<details>
<summary>Причина создания</summary>

Главной целью создания данного плагина было желание быстрым взглядом примерно понять какое время и погода в тех городах, где живут друзья или родственники.

Сначала я сделал большой dataviewjs скрипт. Он мне понравился, но как говорится, лучшее - враг хорошего. Я начал пытаться сделать его чуть красивее, чем получился на тот момент (мне он казался серым и мрачным) и понял, что подбирать HEX коды цветов для каждого градиента, а так же процент заполнения им общей строки - это очень утомительно и неэффективно.

А потом подумал, что не я один такой, кому может захотеться поставить погоду себе в канвас или на стартовой странице. Но подобных решений в репозитории плагинов на первый взгляд я не нашел.

Ну я и начал мучить GPT с этим виджетом =)

</details>

---

**Weather Widget** добавляет в Obsidian живую погодную ленту для нескольких городов с гибкими настройками визуализации. Виджет одинаково рендерится в правой панели, в Markdown-заметках и на Canvas, а также позволяет тонко настроить градиенты, иконки и солнечную подсветку. Дополнительные города можно подключать прямо внутри Markdown-блока, не меняя глобальный список.

## Ключевые возможности

- Несколько городов в одном списке: автоматический учёт часовых поясов, плавные переходы рассвет/закат, температурные градиенты.
- Работает повсюду: отдельная вкладка в боковой панели, Markdown-блоки weather-widget, узлы Canvas.
- Два источника данных (Open-Meteo по умолчанию и OpenWeather).
- Гибкая настройка внешнего вида: иконки для каждого типа погоды, палитра времени суток, параметры солнечного слоя и детальная регулировка градиентов с мгновенным предпросмотром.
- Локализация интерфейса (английский и русский) и автоматическая перерисовка UI при переключении.
- Команды палитры для быстрого открытия вкладки с виджетом или добавления заготовки на Canvas.

## Установка

### Из каталога Obsidian

<details>
<summary>Вы сможете активировать плагин напрямую из Obsidian, когда он появится в каталоге</summary>
- Откройте Settings -> Community plugins
- Нажмите Browse
- Найдите «Weather Widget»
- Установите и включите
- 
</details>

### Ручная установка

- Скачайте `main.js`, `manifest.json`, `styles.css` из последнего релиза и поместите их в папку `<vault>/.obsidian/plugins/obsidian-weather`.
- Включите Weather Widget в *Settings -> Community plugins.*
- 
## Использование

- Откройте виджет в боковой панели через команду **Weather Widget: Open tab**
- Добавьте заготовку на Canvas командой **Weather Widget: Insert Canvas node** — на активный холст упадёт текстовый узел с готовым кодовым блоком.
- В любом ноуте можно просто вставить строку ` ```weather-widget` и на этом месте будет отрисовываться виджет погоды.
- Настройте параметры в *Settings -> Weather Widget* — все изменения применяются сразу.

> [!note] на заметку
Добавляйте дополнительные города прямо в Markdown-блок: каждая непустая строка должна соответствовать шаблону `"Название" <широта> <долгота>` (кавычки обязательны, название может содержать любые символы, в том числе и пробелы. Значения самой строки разделяются пробелами, **без запятых**).\
 Встроенные города объединяются с глобальным списком без дублирования, поэтому можно отображать как просто локальные записи или глобальные, так и комбинировать оба списка в одном виджете.

Минимальный блок выглядит так:
~~~markdown
```weather-widget
~~~
Блок с локальными городами и переопределённой высотой строки:
~~~markdown
```weather-widget
row-height: 24
"Mossingen" 48.406635031986724  9.057441152479019
"Uhan City" 30.59543            114.29987
```
~~~
- `row-height` принимает значение в пикселях и действует только в текущем блоке.
- Высота строки по умолчанию ~36 px и может изменяться в пределах 24–200 px.

## Команды для Ctrl+P

- **Weather Widget: Open tab** — открывает отдельный виджет (по умолчанию в правой панели).
- **Weather Widget: Insert Canvas node** — добавляет на Canvas текстовый узел с минимальной Markdown-заготовкой.

## Справочник по настройкам

### Локализация

- Переключает интерфейс между английским и русским языками. Наименования городов при этом не изменяются.

### Обновление погоды

- Доступно два поставщика данных: Open-Meteo и OpenWeather.
  - Open-Meteo не требует ключа.
  - OpenWeather использует бесплатный API-ключ аккаунта.
- При смене поставщика автоматически подставляется сохранённый ключ и запускается обновление данных.

### Локации
- Управляйте списком городов виджета: задавайте название, широту и долготу, меняйте порядок, удаляйте записи.

> [!note] на заметку
- Названия можно вводить на любом языке, использовать символы и эмодзи.
- Возможность переименовывать точки добавлена специально для удобства. Например, можно сравнивать температуру у подножия и на вершине горы, даже если официального топонима нет.

Строка предпросмотра
Верхняя строка-предпросмотр повторяет реальный виджет и обновляется при каждом изменении. Слайдеры имитируют локальное время и температуру, выпадающий список переключает погодные условия.
> [!note] на заметку

Тонкие правки удобнее вносить стрелками клавиатуры (←/→ ,или ↑/↓ ).

Палитра времени суток
Задайте базовые цвета для утра, дня, вечера и ночи.
Установите, за сколько минут до и после восхода/заката начинается соответствующая цветовая растяжка.
Солнечный слой
Настройте поведение солнца:
Цвета ночи, рассвета, дня и заката.
Профиль прозрачности (подберите форму кривой под тему: от резкого пика до «пузыря»).
Дополнительно отрегулируйте ширину градиента и коэффициент непрозрачности.
Подберите символ солнца, масштаб и тип шрифта (моноширинный или пропорциональный).
> [!note] на заметку

Символ солнца я ввел для обозначения высоты солнца над горизонтом.
Для значка солнца можно выбрать любой текстовый символ или их сочетание. Главное правило для правильного отображения - символ должен быть по центру строки. Вот несколько вариантов значков:

◯○৹●•·◎◉
▣◇◆▪▫
- – —
►◄▻◅▸◂▹◃
⋯Θ⊢⊣

Например, можно использовать символ ◯ чтобы сделать большое кольцо, а можно включить моноширинный шрифт и написать —•— для аккуратного обозначения высоты.
Можно отключить иконку полностью, оставив только цветовой акцент.

Аналогично палитре времени суток настраивается переход цвета и параметры самого солнечного градиента.
Слой погоды
Выберите цвет и по желанию измените иконку для каждой категории погоды (солнечно, облачно, морось, снег и т.д.).
Настройте профиль альфы, ширину непрозрачной части, общий коэффициент и затухание слева.
Слой температуры
Подстройте таблицу цветов по температурным значениям: добавляйте новые точки, меняйте порядок, удаляйте лишнее.
Регулировки совпадают со слоем погоды — профиль альфы, ширина центрального сегмента, непрозрачность и затухание справа.
Другие параметры
Ширина краевого градиента — общий множитель для погодного и температурного слоёв. Небольшие значения подходят для компактных индикаторов, крупные хороши для большего заполнения с мягким переходом.

> [!note] на заметку

Особо дотошный "крутитель ручек" в настройках может обнаружить, что ширина центральной части в разных городах может отличаться. Это не баг. Есть небольшой коэффициент, который смещает значения ширины центральной части относительно длины светового дня.

Да здравствуют градации внутри сериализации!